<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>برنامج مركز المصادر</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<header>
  <div class="head">
    <div>
      <h1>برنامج مركز المصادر</h1>
      <div class="sub">العهدة (14 ملف Excel) + الحجز (8 حصص) + جدول أسبوعي + آراء + تقرير</div>
    </div>

    <div class="status">
      <span id="statusText">جاهز</span>
      <button class="ghost" id="btnBooking">الحجز</button>
      <button class="ghost" id="btnSchedule">جدول الحجز</button>
      <button class="ghost" id="btnCustody">العهدة</button>
      <button class="ghost" id="btnFeedback">آراء الزوار</button>
      <button class="ghost" id="btnReport">التقرير</button>
      <button class="ghost" id="btnSettings">إعدادات التخزين</button>
    </div>
  </div>
</header>

<main class="container">

  <!-- الحجز -->
  <section class="card tab" id="tab-booking">
    <h2>حجز الحصص (8 حصص)</h2>
    <div class="grid">
      <div class="field"><label>الاسم</label><input id="b_name" placeholder="اسم المعلم/المعلمة"></div>
      <div class="field"><label>المادة</label><input id="b_subject"></div>
      <div class="field"><label>الصف</label><input id="b_grade" placeholder="مثال: 7/أ"></div>

      <div class="field wide"><label>عنوان الدرس</label><input id="b_lessonTitle"></div>
      <div class="field wide"><label>الهدف من الحجز</label><input id="b_purpose"></div>

      <div class="field"><label>تاريخ الحجز</label><input id="b_date" type="date"></div>
      <div class="field"><label>الحصة</label><select id="b_period"></select></div>
      <div class="field"><label>ملاحظات (اختياري)</label><input id="b_notes"></div>
    </div>

    <div class="actions">
      <button id="btnSubmitBooking">إرسال الحجز</button>
      <button class="secondary" id="btnRefreshBookings">تحديث الحجوزات</button>
    </div>

    <div class="hint">الحفظ المشترك يتم عبر Apps Script (الرابط مدموج داخل app.js). يمكن تغييره من الإعدادات.</div>
  </section>

  <!-- جدول الحجز الأسبوعي (مثل الصورة) -->
  <section class="card tab" id="tab-schedule" hidden>
    <h2>جدول الحجز الأسبوعي</h2>

    <div class="toolbar">
      <button class="ghost" id="btnPrevWeek">⬅ الأسبوع السابق</button>

      <div class="field">
        <label>بداية الأسبوع (الأحد)</label>
        <input id="weekStart" type="date">
      </div>

      <button class="ghost" id="btnNextWeek">الأسبوع التالي ➡</button>
      <button class="ghost" id="btnRefreshWeek">تحديث</button>
    </div>

    <div class="hint">
      يظهر الحجز داخل خلية (اليوم × الحصة). إذا وُجد أكثر من حجز لنفس الخلية يظهر "تعارض".
    </div>

    <div class="tableWrap">
      <table id="weekTable">
        <thead id="weekHead"></thead>
        <tbody id="weekBody"></tbody>
      </table>
    </div>
  </section>

  <!-- العهدة -->
  <section class="card tab" id="tab-custody" hidden>
    <h2>العهدة (14 قسم)</h2>
    <div class="hint">اضغط قسم لعرض ملف Excel الخاص به من مجلد <b>data/</b>.</div>

    <div class="deptChips" id="custodyChips"></div>

    <div class="toolbar">
      <div class="field"><label>بحث داخل الكتب</label><input id="c_q" placeholder="العنوان/المؤلفون/المواضيع..."></div>
      <button class="ghost" id="btnReloadCustody">إعادة تحميل القسم</button>
    </div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>الرقم العام</th><th>رقم التصنيف</th><th>رقم الطلب</th><th>العنوان</th><th>المواضيع</th><th>المؤلفون</th>
            <th>سنة النشر</th><th>الناشر</th><th>يعار/لا يعار</th><th>عام/مرجع</th>
          </tr>
        </thead>
        <tbody id="custodyBody"></tbody>
      </table>
    </div>
  </section>

  <!-- آراء الزوار -->
  <section class="card tab" id="tab-feedback" hidden>
    <h2>آراء الزوار</h2>
    <div class="grid">
      <div class="field"><label>الفئة</label>
        <select id="f_type"><option>طالب</option><option>معلم</option><option>زائر</option><option>إداري</option><option>ولي أمر</option><option>أخرى</option></select>
      </div>
      <div class="field"><label>التقييم (1-5)</label>
        <select id="f_rate"><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select>
      </div>
      <div class="field"><label>الاسم (اختياري)</label><input id="f_name"></div>
      <div class="field wide"><label>الرأي/الملاحظة</label><textarea id="f_text"></textarea></div>
    </div>
    <div class="actions">
      <button id="btnSubmitFeedback">إرسال الرأي</button>
    </div>
  </section>

  <!-- التقرير -->
  <section class="card tab" id="tab-report" hidden>
    <h2>التقرير</h2>
    <div class="reportGrid">
      <div class="kpi"><div class="k">إجمالي الحجوزات</div><div class="v" id="r_totalBookings">0</div></div>
      <div class="kpi"><div class="k">حجوزات اليوم</div><div class="v" id="r_todayBookings">0</div></div>
      <div class="kpi"><div class="k">عدد التعارضات</div><div class="v" id="r_conflicts">0</div></div>
      <div class="kpi"><div class="k">إجمالي الآراء</div><div class="v" id="r_totalFeedback">0</div></div>
      <div class="kpi"><div class="k">متوسط التقييم</div><div class="v" id="r_avgRate">0</div></div>
    </div>
  </section>

</main>

<dialog id="settingsDlg" class="dlg">
  <div class="card">
    <h2>إعدادات التخزين</h2>
    <div class="field">
      <label>رابط Apps Script Web App (اختياري)</label>
      <input id="apiUrl" placeholder="اتركه فارغاً لاستخدام الرابط المدموج">
      <div class="hint">إذا تركته فارغاً سيتم استخدام الرابط المدموج داخل app.js تلقائيًا.</div>
    </div>
    <div class="actions">
      <button id="btnSaveSettings">حفظ</button>
      <button class="ghost" id="btnCloseSettings">إغلاق</button>
    </div>
  </div>
</dialog>

<script src="app.js"></script>
</body>
</html>
